name: Notify Discord on PR Merged to Develop

on:
  pull_request:
    types: [closed] # PRì´ ë‹«í˜”ì„ ë•Œ (ë³‘í•© í¬í•¨)
    branches:
      - develop # develop ë¸Œëœì¹˜ë¡œ PR ë³‘í•© ì‹œ ê°ì§€

jobs:
  notify:
    if: github.event.pull_request.merged == true # ë³‘í•©ëœ ê²½ìš°ë§Œ ì‹¤í–‰
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord notification (embed)
        env:
          BASE_BRANCH: ${{ github.event.pull_request.base.ref }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_AUTHOR: ${{ github.event.pull_request.user.login }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_BODY: ${{ github.event.pull_request.body || 'ë‚´ìš© ì—†ìŒ' }}
        run: |
          # ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
          PR_BODY_ESCAPED=$(echo "$PR_BODY" | jq -Rs . | sed 's/^"//;s/"$//')

          # ë©”ì‹œì§€ ì „ì†¡
          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{\"embeds\": [
                {
                  \"title\": \"âœ… PR Merged to \`$BASE_BRANCH\`! [PR ë§í¬]\",
                  \"url\": \"$PR_URL\",
                  \"description\": \"**Title:** $PR_TITLE\\n**Author:** $PR_AUTHOR\\n\\nğŸ“ **Description:**\\n\`\`\`\\n$PR_BODY_ESCAPED\\n\`\`\`\",
                  \"color\": 3066993
                }
              ]
            }" "${{ secrets.DISCORD_WEBHOOK_PR_URL }}"