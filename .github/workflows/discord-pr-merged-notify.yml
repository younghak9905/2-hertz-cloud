name: Notify Discord on PR Merged to Develop

on:
  pull_request:
    types: [closed]  # PRì´ ë‹«í˜”ì„ ë•Œ (ë³‘í•© í¬í•¨)
    branches:
      - develop       # develop ë¸Œëœì¹˜ë¡œ PR ë³‘í•© ì‹œ ê°ì§€

jobs:
  notify:
    if: github.event.pull_request.merged == true  # ë³‘í•©ëœ ê²½ìš°ë§Œ ì‹¤í–‰
    runs-on: ubuntu-latest
    steps:
      - name: Dump event payload
        run: echo '${{ toJson(github.event) }}' > event.json
      - name: Send notification to Discord
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_AUTHOR: ${{ github.event.pull_request.user.login }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_BODY: ${{ github.event.pull_request.body || 'ë‚´ìš© ì—†ìŒ' }}
        run: |
          # PR ë³¸ë¬¸ì„ JSON í˜•ì‹ì— ë§ê²Œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
          PR_BODY_ESCAPED=$(echo "$PR_BODY" | jq -Rs .)
          
          # Discordë¡œ ë©”ì‹œì§€ ì „ì†¡
          curl -H "Content-Type: application/json" \
              -X POST \
              -d "{\"content\": \"âœ… PR Merged to **develop**!\\n\\n**Title:** $PR_TITLE\\n**Author:** $PR_AUTHOR\\n\\nğŸ“ **Description:**\\n\`\`\`markdown\\n$(echo $PR_BODY_ESCAPED | sed 's/^"//;s/"$//')\\n\`\`\`\\n\\nğŸ”— $PR_URL\"}" \
              "${{ secrets.DISCORD_WEBHOOK_URL }}"